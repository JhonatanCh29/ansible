---
# Playbook para instalar servicios faltantes antes del principal
- name: ðŸ”§ Instalar servicios prerequisitos para Nivel 4
  hosts: lab_academico
  become: yes
  gather_facts: yes
  
  tasks:
    - name: ðŸ“¦ Instalar servicios bÃ¡sicos en Fedora/CentOS
      package:
        name:
          - openssh-server
          - cronie
          - rsyslog
        state: present
      when: ansible_facts['os_family'] == "RedHat"
      
    - name: ðŸ“¦ Instalar servicios bÃ¡sicos en Ubuntu/Mint
      package:
        name:
          - openssh-server
          - cron
          - rsyslog
        state: present
      when: ansible_facts['os_family'] == "Debian"
      
    - name: ðŸš€ Habilitar servicios
      service:
        name: "{{ item }}"
        enabled: yes
        state: started
      loop:
        - sshd
        - crond
        - rsyslog
      when: ansible_facts['os_family'] == "RedHat"
      ignore_errors: yes
      
    - name: ðŸš€ Habilitar servicios Ubuntu/Mint
      service:
        name: "{{ item }}"
        enabled: yes
        state: started
      loop:
        - ssh
        - cron
        - rsyslog
      when: ansible_facts['os_family'] == "Debian"
      ignore_errors: yes
      
    - name: ðŸ‘¤ Crear usuario control si no existe
      user:
        name: control
        shell: /bin/bash
        create_home: yes
        groups: sudo
        state: present
      ignore_errors: yes