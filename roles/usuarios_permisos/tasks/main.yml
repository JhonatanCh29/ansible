---
# üìå Rol 2: Administraci√≥n de usuarios, permisos y pol√≠ticas

# ‚úÖ 1. Crear grupos necesarios
- name: Crear grupos b√°sicos
  ansible.builtin.group:
    name: "{{ item }}"
    state: present
  loop:
    - docentes
    - soporte
    - laboratorio

# ‚úÖ 2. Crear usuarios y asignarlos a grupos
- name: Crear usuarios y asignarles grupo
  ansible.builtin.user:
    name: "{{ item.name }}"
    state: present
    groups: "{{ item.group }}"
    shell: /bin/bash
    create_home: yes
  loop:
    - { name: "adminlab", group: "laboratorio" }
    - { name: "tecnico1", group: "soporte" }
    - { name: "profesor1", group: "docentes" }

# ‚úÖ 3. Establecer contrase√±a a los usuarios (opcional)
# ‚ö† La contrase√±a debe estar en formato encriptado SHA512
- name: Colocar contrase√±as a usuarios
  ansible.builtin.user:
    name: "{{ item.name }}"
    password: "{{ item.pass }}"
  loop:
    - { name: "adminlab",  pass: "{{ 'admin123' | password_hash('sha512') }}" }
    - { name: "tecnico1",  pass: "{{ 'tecnico123' | password_hash('sha512') }}" }
    - { name: "profesor1", pass: "{{ 'prof123' | password_hash('sha512') }}" }

# ‚úÖ 4. Habilitar sudo sin contrase√±a a un usuario espec√≠fico
- name: Permitir sudo sin contrase√±a a adminlab
  ansible.builtin.copy:
    dest: /etc/sudoers.d/adminlab
    content: "adminlab ALL=(ALL) NOPASSWD:ALL"
    owner: root
    group: root
    mode: '0440'

# ‚úÖ 5. Asegurar permisos correctos en /home
- name: Asignar due√±o correcto a los home de cada usuario
  ansible.builtin.file:
    path: "/home/{{ item }}"
    owner: "{{ item }}"
    group: "{{ item }}"
    state: directory
    recurse: yes
  loop:
    - adminlab
    - tecnico1
    - profesor1
